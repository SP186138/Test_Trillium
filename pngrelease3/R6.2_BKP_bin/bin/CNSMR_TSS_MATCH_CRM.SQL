DATABASE MDM;


REPLACE VIEW MDM.CNSMR_TSS_MATCH_CRM
AS
LOCKING ROW FOR ACCESS

SELECT
	 REGIS_PRSNA_1.MKTNG_PGM_NBR
	,REGIS_PRSNA_1.REGIS_CNSMR_ID_VAL
	,REGIS_PRSNA_1.NAME_PREFX_TXT
	,REGIS_PRSNA_1.GVN_NAME
	,REGIS_PRSNA_1.MID_NAME
	,REGIS_PRSNA_1.FAMLY_NAME
	,REGIS_PRSNA_1.NAME_SUFFX_TXT
	,REGIS_PRSNA_1.FULL_NAME
	,REGIS_PRSNA_1.GENDR_IND
	,REGIS_PRSNA_1.BRTH_DATE
	,REGIS_PRSNA_1.CNSMR_USER_NAME
	,REGIS_PRSNA_1.LANG_CODE
	,PRSNA_POSTL_ADDR_1.ADDR_LINE_1_TXT
	,PRSNA_POSTL_ADDR_1.ADDR_LINE_2_TXT
	,PRSNA_POSTL_ADDR_1.ADDR_LINE_3_TXT
	,PRSNA_POSTL_ADDR_1.STRET_NUM
	,PRSNA_POSTL_ADDR_1.STRET_NAME
	,PRSNA_POSTL_ADDR_1.APT_NUM
	,PRSNA_POSTL_ADDR_1.PO_BOX_NUM
	,PRSNA_POSTL_ADDR_1.CITY_NAME
	,PRSNA_POSTL_ADDR_1.POSTL_AREA_CODE
	,PRSNA_POSTL_ADDR_1.TERR_CODE
	,PRSNA_POSTL_ADDR_1.CNTRY_CODE
	,PRSNA_EMAIL_ADDR_1.EMAIL_ADDR_TXT AS EMAIL_ADDR_TXT_1
	,PRSNA_PHONE_1.PHONE_CNTRY_NBR AS PHONE_CNTRY_NBR_1
	,PRSNA_PHONE_1.PHONE_AREA_NBR  AS PHONE_AREA_NBR_1
	,PRSNA_PHONE_1.PHONE_EXCHG_NBR AS PHONE_EXCHG_NBR_1
	,PRSNA_PHONE_1.PHONE_LINE_NBR  AS PHONE_LINE_NBR_1
	,PRSNA_PHONE_1.PHONE_EXTSN_NUM AS PHONE_EXTSN_NUM_1
	,PRSNA_PHONE_1.FULL_PHONE_NUM  AS FULL_PHONE_NUM_1
	,PRSNA_POSTL_ADDR_1.WIN_KEY
	,DPEND_1.DPEND_NAME
	,PET_1.PET_NAME
	,REGIS_PRSNA_1.REGIS_PRSNA_ID 
	,LEGAL_ENT_PRSNA_1.MATCHD_CNSMR_PRSNA_ID
	,LEGAL_ENT_PRSNA_1.HSHLD_PRSNA_ID
	,REGIS_PRSNA_1.LEGAL_ENT_NBR

  FROM MDM_MST.REGIS_PRSNA REGIS_PRSNA_1

  LEFT OUTER JOIN MDM_MST.MATCHD_CNSMR_PRSNA LEGAL_ENT_PRSNA_1
    ON REGIS_PRSNA_1.MATCHD_CNSMR_PRSNA_ID = LEGAL_ENT_PRSNA_1.MATCHD_CNSMR_PRSNA_ID
   
  LEFT OUTER JOIN MDM_MST.REGIS_PRSNA_POSTL_ADDR PRSNA_POSTL_ADDR_1
    ON REGIS_PRSNA_1.REGIS_PRSNA_ID = PRSNA_POSTL_ADDR_1.REGIS_PRSNA_ID
   AND REGIS_PRSNA_1.MKTNG_PGM_NBR = PRSNA_POSTL_ADDR_1.MKTNG_PGM_NBR
   AND REGIS_PRSNA_1.LEGAL_ENT_NBR = PRSNA_POSTL_ADDR_1.LEGAL_ENT_NBR

  LEFT OUTER JOIN MDM_MST.REGIS_PRSNA_PHONE PRSNA_PHONE_1
    ON REGIS_PRSNA_1.REGIS_PRSNA_ID = PRSNA_PHONE_1.REGIS_PRSNA_ID
   AND REGIS_PRSNA_1.MKTNG_PGM_NBR = PRSNA_PHONE_1.MKTNG_PGM_NBR
   AND REGIS_PRSNA_1.LEGAL_ENT_NBR = PRSNA_PHONE_1.LEGAL_ENT_NBR
    
  LEFT OUTER JOIN MDM_MST.REGIS_PRSNA_EMAIL_ADDR PRSNA_EMAIL_ADDR_1
    ON REGIS_PRSNA_1.REGIS_PRSNA_ID = PRSNA_EMAIL_ADDR_1.REGIS_PRSNA_ID
   AND REGIS_PRSNA_1.MKTNG_PGM_NBR = PRSNA_EMAIL_ADDR_1.MKTNG_PGM_NBR
   AND REGIS_PRSNA_1.LEGAL_ENT_NBR = PRSNA_EMAIL_ADDR_1.LEGAL_ENT_NBR 

  LEFT OUTER JOIN MDM_MST.DPEND DPEND_1
    ON REGIS_PRSNA_1.REGIS_PRSNA_ID = DPEND_1.REGIS_PRSNA_ID
   AND REGIS_PRSNA_1.MKTNG_PGM_NBR = DPEND_1.MKTNG_PGM_NBR
   AND REGIS_PRSNA_1.LEGAL_ENT_NBR = DPEND_1.LEGAL_ENT_NBR

  LEFT OUTER JOIN MDM_MST.PET PET_1
    ON REGIS_PRSNA_1.REGIS_PRSNA_ID = PET_1.REGIS_PRSNA_ID
   AND REGIS_PRSNA_1.MKTNG_PGM_NBR = PET_1.MKTNG_PGM_NBR
   AND REGIS_PRSNA_1.LEGAL_ENT_NBR = PET_1.LEGAL_ENT_NBR
;

