DATABASE MDM;


REPLACE VIEW MDM.CNSMR_TSS_CLEANSE_INPUT
AS
LOCKING ROW FOR ACCESS

SELECT
         MKTNG_PGM_1.LEGAL_ENT_NBR
	,PRSNA_STG_1.MKTNG_PGM_NBR
	,PRSNA_STG_1.REGIS_CNSMR_ID_VAL
	,PRSNA_STG_1.NAME_PREFX_TXT
	,PRSNA_STG_1.GVN_NAME
	,PRSNA_STG_1.MID_NAME
	,PRSNA_STG_1.FAMLY_NAME
	,PRSNA_STG_1.NAME_SUFFX_TXT
	,PRSNA_STG_1.FULL_NAME
	,PRSNA_STG_1.GENDR_IND
	,PRSNA_STG_1.BRTH_DATE
	,PRSNA_POSTL_ADDR_STG_1.ADDR_LINE_1_TXT
	,PRSNA_POSTL_ADDR_STG_1.ADDR_LINE_2_TXT
	,PRSNA_POSTL_ADDR_STG_1.ADDR_LINE_3_TXT
	,PRSNA_POSTL_ADDR_STG_1.STRET_NUM
	,PRSNA_POSTL_ADDR_STG_1.STRET_NAME
	,PRSNA_POSTL_ADDR_STG_1.APT_NUM
	,PRSNA_POSTL_ADDR_STG_1.PO_BOX_NUM
	,PRSNA_POSTL_ADDR_STG_1.CITY_NAME
	,PRSNA_POSTL_ADDR_STG_1.POSTL_AREA_CODE
	,PRSNA_POSTL_ADDR_STG_1.TERR_NAME
	,PRSNA_POSTL_ADDR_STG_1.CNTRY_NAME
	,PRSNA_EMAIL_ADDR_STG_1.EMAIL_ADDR_TXT AS EMAIL_ADDR_TXT_1
	,PRSNA_PHONE_STG_1.PHONE_EXTSN_NUM AS PHONE_EXTSN_NUM_1
	,PRSNA_PHONE_STG_1.FULL_PHONE_NUM  AS FULL_PHONE_NUM_1
	,PRSNA_PHONE_STG_1.PHONE_LINE_NBR  AS PHONE_LINE_NBR_1
	,PRSNA_PHONE_STG_1.PHONE_AREA_NBR  AS PHONE_AREA_NBR_1
	,PRSNA_PHONE_STG_1.PHONE_EXCHG_NBR AS PHONE_EXCHG_NBR_1
	,PRSNA_PHONE_STG_1.PHONE_CNTRY_NBR AS PHONE_CNTRY_NBR_1
	,DPEND_STG_1.DPEND_NAME
	,PET_STG_1.PET_NAME
	,PRSNA_STG_1.WIN_KEY
	,PRSNA_STG_1.SYNC_STATUS
	,PRSNA_STG_1.USER_NAME
	,PRSNA_STG_1.LANG_CODE
	,TRIM(CAST(PRSNA_STG_1.SYS_SOURCE AS INTEGER)) AS SYS_SOURCE
	,PRSNA_STG_1.SYS_NC_TYPE      
        ,PRSNA_STG_1.SYS_CREATION_date

  FROM MDM_MST.PRSNA_STG PRSNA_STG_1

  LEFT OUTER JOIN MDM_MST.PRSNA_POSTL_ADDR_STG PRSNA_POSTL_ADDR_STG_1
    ON PRSNA_STG_1.MKTNG_PGM_NBR = PRSNA_POSTL_ADDR_STG_1.MKTNG_PGM_NBR
   AND PRSNA_STG_1.REGIS_CNSMR_ID_VAL = PRSNA_POSTL_ADDR_STG_1.REGIS_CNSMR_ID_VAL

  LEFT OUTER JOIN MDM_MST.PRSNA_PHONE_STG PRSNA_PHONE_STG_1
    ON PRSNA_STG_1.MKTNG_PGM_NBR = PRSNA_PHONE_STG_1.MKTNG_PGM_NBR
   AND PRSNA_STG_1.REGIS_CNSMR_ID_VAL = PRSNA_PHONE_STG_1.REGIS_CNSMR_ID_VAL
 
  LEFT OUTER JOIN MDM_MST.PRSNA_EMAIL_ADDR_STG PRSNA_EMAIL_ADDR_STG_1
    ON PRSNA_STG_1.MKTNG_PGM_NBR = PRSNA_EMAIL_ADDR_STG_1.MKTNG_PGM_NBR
   AND PRSNA_STG_1.REGIS_CNSMR_ID_VAL = PRSNA_EMAIL_ADDR_STG_1.REGIS_CNSMR_ID_VAL

  LEFT OUTER JOIN MDM_MST.DPEND_STG DPEND_STG_1
    ON PRSNA_STG_1.MKTNG_PGM_NBR = DPEND_STG_1.MKTNG_PGM_NBR
   AND PRSNA_STG_1.REGIS_CNSMR_ID_VAL = DPEND_STG_1.REGIS_CNSMR_ID_VAL

  LEFT OUTER JOIN MDM_MST.PET_STG PET_STG_1
    ON PRSNA_STG_1.MKTNG_PGM_NBR = PET_STG_1.MKTNG_PGM_NBR
   AND PRSNA_STG_1.REGIS_CNSMR_ID_VAL = PET_STG_1.REGIS_CNSMR_ID_VAL
   
  LEFT OUTER JOIN MDM_MST.MKTNG_PGM MKTNG_PGM_1
    ON PRSNA_STG_1.MKTNG_PGM_NBR = MKTNG_PGM_1.MKTNG_PGM_NBR

 WHERE PRSNA_STG_1.SYNC_STATUS IN ('VALIDATED')
   AND (PRSNA_POSTL_ADDR_STG_1.SYNC_STATUS IN ('VALIDATED') OR PRSNA_POSTL_ADDR_STG_1.SYNC_STATUS IS NULL)
   AND (PRSNA_PHONE_STG_1.SYNC_STATUS IN ('VALIDATED') OR PRSNA_PHONE_STG_1.SYNC_STATUS IS NULL)
   AND (PRSNA_EMAIL_ADDR_STG_1.SYNC_STATUS IN ('VALIDATED') OR PRSNA_EMAIL_ADDR_STG_1.SYNC_STATUS IS NULL)
;

