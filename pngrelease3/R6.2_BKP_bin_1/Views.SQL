REPLACE VIEW PNGMDM.CNSMR_TSS_CLEANSE_INPUT
AS
LOCKING ROW FOR ACCESS

SELECT
         MKTNG_PGM_1.LEGAL_ENT_NBR
	,PRSNA_STG_1.MKTNG_PGM_NBR
	,PRSNA_STG_1.REGIS_CNSMR_ID_VAL
	,PRSNA_STG_1.NAME_PREFX_TXT
	,PRSNA_STG_1.GVN_NAME
	,PRSNA_STG_1.MID_NAME
	,PRSNA_STG_1.FAMLY_NAME
	,PRSNA_STG_1.NAME_SUFFX_TXT
	,PRSNA_STG_1.FULL_NAME
	,PRSNA_STG_1.GENDR_IND
	,PRSNA_STG_1.BRTH_DATE
	,PRSNA_POSTL_ADDR_STG_1.ADDR_LINE_1_TXT
	,PRSNA_POSTL_ADDR_STG_1.ADDR_LINE_2_TXT
	,PRSNA_POSTL_ADDR_STG_1.ADDR_LINE_3_TXT
	,PRSNA_POSTL_ADDR_STG_1.STRET_NUM
	,PRSNA_POSTL_ADDR_STG_1.STRET_NAME
	,PRSNA_POSTL_ADDR_STG_1.APT_NUM
	,PRSNA_POSTL_ADDR_STG_1.PO_BOX_NUM
	,PRSNA_POSTL_ADDR_STG_1.CITY_NAME
	,PRSNA_POSTL_ADDR_STG_1.POSTL_AREA_CODE
	,PRSNA_POSTL_ADDR_STG_1.TERR_NAME
	,PRSNA_POSTL_ADDR_STG_1.CNTRY_NAME
	,PRSNA_EMAIL_ADDR_STG_1.EMAIL_ADDR_TXT AS EMAIL_ADDR_TXT_1
	,PRSNA_PHONE_STG_1.PHONE_EXTSN_NUM AS PHONE_EXTSN_NUM_1
	,PRSNA_PHONE_STG_1.FULL_PHONE_NUM  AS FULL_PHONE_NUM_1
	,PRSNA_PHONE_STG_1.PHONE_LINE_NBR  AS PHONE_LINE_NBR_1
	,PRSNA_PHONE_STG_1.PHONE_AREA_NBR  AS PHONE_AREA_NBR_1
	,PRSNA_PHONE_STG_1.PHONE_EXCHG_NBR AS PHONE_EXCHG_NBR_1
	,PRSNA_PHONE_STG_1.PHONE_CNTRY_NBR AS PHONE_CNTRY_NBR_1
	,DPEND_STG_1.DPEND_NAME
	,PET_STG_1.PET_NAME
	,PRSNA_STG_1.WIN_KEY
	,PRSNA_STG_1.SYNC_STATUS
	,PRSNA_STG_1.USER_NAME
	,PRSNA_STG_1.LANG_CODE
	,TRIM(CAST(PRSNA_STG_1.SYS_SOURCE AS INTEGER)) AS SYS_SOURCE
	,PRSNA_STG_1.SYS_NC_TYPE      
        ,PRSNA_STG_1.SYS_CREATION_date

  FROM PNGMDM_MST.PRSNA_STG PRSNA_STG_1

  LEFT OUTER JOIN PNGMDM_MST.PRSNA_POSTL_ADDR_STG PRSNA_POSTL_ADDR_STG_1
    ON PRSNA_STG_1.MKTNG_PGM_NBR = PRSNA_POSTL_ADDR_STG_1.MKTNG_PGM_NBR
   AND PRSNA_STG_1.REGIS_CNSMR_ID_VAL = PRSNA_POSTL_ADDR_STG_1.REGIS_CNSMR_ID_VAL

  LEFT OUTER JOIN PNGMDM_MST.PRSNA_PHONE_STG PRSNA_PHONE_STG_1
    ON PRSNA_STG_1.MKTNG_PGM_NBR = PRSNA_PHONE_STG_1.MKTNG_PGM_NBR
   AND PRSNA_STG_1.REGIS_CNSMR_ID_VAL = PRSNA_PHONE_STG_1.REGIS_CNSMR_ID_VAL
 
  LEFT OUTER JOIN PNGMDM_MST.PRSNA_EMAIL_ADDR_STG PRSNA_EMAIL_ADDR_STG_1
    ON PRSNA_STG_1.MKTNG_PGM_NBR = PRSNA_EMAIL_ADDR_STG_1.MKTNG_PGM_NBR
   AND PRSNA_STG_1.REGIS_CNSMR_ID_VAL = PRSNA_EMAIL_ADDR_STG_1.REGIS_CNSMR_ID_VAL

  LEFT OUTER JOIN PNGMDM_MST.DPEND_STG DPEND_STG_1
    ON PRSNA_STG_1.MKTNG_PGM_NBR = DPEND_STG_1.MKTNG_PGM_NBR
   AND PRSNA_STG_1.REGIS_CNSMR_ID_VAL = DPEND_STG_1.REGIS_CNSMR_ID_VAL

  LEFT OUTER JOIN PNGMDM_MST.PET_STG PET_STG_1
    ON PRSNA_STG_1.MKTNG_PGM_NBR = PET_STG_1.MKTNG_PGM_NBR
   AND PRSNA_STG_1.REGIS_CNSMR_ID_VAL = PET_STG_1.REGIS_CNSMR_ID_VAL
   
  LEFT OUTER JOIN PNGMDM_MST.MKTNG_PGM MKTNG_PGM_1
    ON PRSNA_STG_1.MKTNG_PGM_NBR = MKTNG_PGM_1.MKTNG_PGM_NBR

 WHERE PRSNA_STG_1.SYNC_STATUS IN ('VALIDATED')
   AND (PRSNA_POSTL_ADDR_STG_1.SYNC_STATUS IN ('VALIDATED') OR PRSNA_POSTL_ADDR_STG_1.SYNC_STATUS IS NULL)
   AND (PRSNA_PHONE_STG_1.SYNC_STATUS IN ('VALIDATED') OR PRSNA_PHONE_STG_1.SYNC_STATUS IS NULL)
   AND (PRSNA_EMAIL_ADDR_STG_1.SYNC_STATUS IN ('VALIDATED') OR PRSNA_EMAIL_ADDR_STG_1.SYNC_STATUS IS NULL)
;




REPLACE VIEW PNGMDM.CNSMR_TSS_MATCH_CRM
AS
LOCKING ROW FOR ACCESS

SELECT
	 REGIS_PRSNA_1.MKTNG_PGM_NBR
	,REGIS_PRSNA_1.REGIS_CNSMR_ID_VAL
	,REGIS_PRSNA_1.NAME_PREFX_TXT
	,REGIS_PRSNA_1.GVN_NAME
	,REGIS_PRSNA_1.MID_NAME
	,REGIS_PRSNA_1.FAMLY_NAME
	,REGIS_PRSNA_1.NAME_SUFFX_TXT
	,REGIS_PRSNA_1.FULL_NAME
	,REGIS_PRSNA_1.GENDR_IND
	,REGIS_PRSNA_1.BRTH_DATE
	,REGIS_PRSNA_1.CNSMR_USER_NAME
	,REGIS_PRSNA_1.LANG_CODE
	,PRSNA_POSTL_ADDR_1.ADDR_LINE_1_TXT
	,PRSNA_POSTL_ADDR_1.ADDR_LINE_2_TXT
	,PRSNA_POSTL_ADDR_1.ADDR_LINE_3_TXT
	,PRSNA_POSTL_ADDR_1.STRET_NUM
	,PRSNA_POSTL_ADDR_1.STRET_NAME
	,PRSNA_POSTL_ADDR_1.APT_NUM
	,PRSNA_POSTL_ADDR_1.PO_BOX_NUM
	,PRSNA_POSTL_ADDR_1.CITY_NAME
	,PRSNA_POSTL_ADDR_1.POSTL_AREA_CODE
	,PRSNA_POSTL_ADDR_1.TERR_CODE
	,PRSNA_POSTL_ADDR_1.CNTRY_CODE
	,PRSNA_EMAIL_ADDR_1.EMAIL_ADDR_TXT AS EMAIL_ADDR_TXT_1
	,PRSNA_PHONE_1.PHONE_CNTRY_NBR AS PHONE_CNTRY_NBR_1
	,PRSNA_PHONE_1.PHONE_AREA_NBR  AS PHONE_AREA_NBR_1
	,PRSNA_PHONE_1.PHONE_EXCHG_NBR AS PHONE_EXCHG_NBR_1
	,PRSNA_PHONE_1.PHONE_LINE_NBR  AS PHONE_LINE_NBR_1
	,PRSNA_PHONE_1.PHONE_EXTSN_NUM AS PHONE_EXTSN_NUM_1
	,PRSNA_PHONE_1.FULL_PHONE_NUM  AS FULL_PHONE_NUM_1
	,PRSNA_POSTL_ADDR_1.WIN_KEY
	,DPEND_1.DPEND_NAME
	,PET_1.PET_NAME
	,REGIS_PRSNA_1.REGIS_PRSNA_ID 
	,LEGAL_ENT_PRSNA_1.MATCHD_CNSMR_PRSNA_ID
	,LEGAL_ENT_PRSNA_1.HSHLD_PRSNA_ID
	,REGIS_PRSNA_1.LEGAL_ENT_NBR

  FROM PNGMDM_MST.REGIS_PRSNA REGIS_PRSNA_1

  LEFT OUTER JOIN PNGMDM_MST.MATCHD_CNSMR_PRSNA LEGAL_ENT_PRSNA_1
    ON REGIS_PRSNA_1.MATCHD_CNSMR_PRSNA_ID = LEGAL_ENT_PRSNA_1.MATCHD_CNSMR_PRSNA_ID
   
  LEFT OUTER JOIN PNGMDM_MST.REGIS_PRSNA_POSTL_ADDR PRSNA_POSTL_ADDR_1
    ON REGIS_PRSNA_1.REGIS_PRSNA_ID = PRSNA_POSTL_ADDR_1.REGIS_PRSNA_ID
   AND REGIS_PRSNA_1.MKTNG_PGM_NBR = PRSNA_POSTL_ADDR_1.MKTNG_PGM_NBR
   AND REGIS_PRSNA_1.LEGAL_ENT_NBR = PRSNA_POSTL_ADDR_1.LEGAL_ENT_NBR

  LEFT OUTER JOIN PNGMDM_MST.REGIS_PRSNA_PHONE PRSNA_PHONE_1
    ON REGIS_PRSNA_1.REGIS_PRSNA_ID = PRSNA_PHONE_1.REGIS_PRSNA_ID
   AND REGIS_PRSNA_1.MKTNG_PGM_NBR = PRSNA_PHONE_1.MKTNG_PGM_NBR
   AND REGIS_PRSNA_1.LEGAL_ENT_NBR = PRSNA_PHONE_1.LEGAL_ENT_NBR
    
  LEFT OUTER JOIN PNGMDM_MST.REGIS_PRSNA_EMAIL_ADDR PRSNA_EMAIL_ADDR_1
    ON REGIS_PRSNA_1.REGIS_PRSNA_ID = PRSNA_EMAIL_ADDR_1.REGIS_PRSNA_ID
   AND REGIS_PRSNA_1.MKTNG_PGM_NBR = PRSNA_EMAIL_ADDR_1.MKTNG_PGM_NBR
   AND REGIS_PRSNA_1.LEGAL_ENT_NBR = PRSNA_EMAIL_ADDR_1.LEGAL_ENT_NBR 

  LEFT OUTER JOIN PNGMDM_MST.DPEND DPEND_1
    ON REGIS_PRSNA_1.REGIS_PRSNA_ID = DPEND_1.REGIS_PRSNA_ID
   AND REGIS_PRSNA_1.MKTNG_PGM_NBR = DPEND_1.MKTNG_PGM_NBR
   AND REGIS_PRSNA_1.LEGAL_ENT_NBR = DPEND_1.LEGAL_ENT_NBR

  LEFT OUTER JOIN PNGMDM_MST.PET PET_1
    ON REGIS_PRSNA_1.REGIS_PRSNA_ID = PET_1.REGIS_PRSNA_ID
   AND REGIS_PRSNA_1.MKTNG_PGM_NBR = PET_1.MKTNG_PGM_NBR
   AND REGIS_PRSNA_1.LEGAL_ENT_NBR = PET_1.LEGAL_ENT_NBR
;


REPLACE VIEW PNGMDM.CNSMR_TSS_WINKEY
AS
LOCKING ROW FOR ACCESS

SELECT
	  WINDOW_KEY_01                 
	 ,EMAIL_ADDR_TXT
         ,PHONE

  FROM PNGMDM_MST.WINKEY_TRIGGER
;




REPLACE VIEW PNGMDM.CNSMR_TSS_MATCH_INPUT
AS
LOCKING ROW FOR ACCESS

SELECT 
	  CNSMR_TSS_MATCH_CRM_1.MKTNG_PGM_NBR      AS MKTNG_PGM_NBR_CRM            
	 ,CNSMR_TSS_MATCH_CRM_1.REGIS_CNSMR_ID_VAL AS REGIS_CNSMR_ID_VAL_CRM       
	 ,CNSMR_TSS_MATCH_CRM_1.NAME_PREFX_TXT     AS NAME_PREFX_TXT_CRM           
	 ,CNSMR_TSS_MATCH_CRM_1.GVN_NAME           AS GVN_NAME_CRM                 
	 ,CNSMR_TSS_MATCH_CRM_1.MID_NAME           AS MID_NAME_CRM                 
	 ,CNSMR_TSS_MATCH_CRM_1.FAMLY_NAME         AS FAMLY_NAME_CRM               
	 ,CNSMR_TSS_MATCH_CRM_1.NAME_SUFFX_TXT     AS NAME_SUFFX_TXT_CRM           
	 ,CNSMR_TSS_MATCH_CRM_1.FULL_NAME          AS FULL_NAME_CRM                
	 ,CNSMR_TSS_MATCH_CRM_1.GENDR_IND          AS GENDR_IND_CRM                
	 ,CNSMR_TSS_MATCH_CRM_1.BRTH_DATE          AS BRTH_DATE_CRM                
	 ,CNSMR_TSS_MATCH_CRM_1.CNSMR_USER_NAME    AS USER_NAME_CRM                
	 ,CNSMR_TSS_MATCH_CRM_1.LANG_CODE          AS LANG_CODE_CRM    
	 ,CNSMR_TSS_MATCH_CRM_1.ADDR_LINE_1_TXT    AS ADDR_LINE_1_TXT_CRM          
	 ,CNSMR_TSS_MATCH_CRM_1.ADDR_LINE_2_TXT    AS ADDR_LINE_2_TXT_CRM          
	 ,CNSMR_TSS_MATCH_CRM_1.ADDR_LINE_3_TXT    AS ADDR_LINE_3_TXT_CRM          
	 ,CNSMR_TSS_MATCH_CRM_1.STRET_NUM          AS STRET_NUM_CRM                
	 ,CNSMR_TSS_MATCH_CRM_1.STRET_NAME         AS STRET_NAME_CRM               
	 ,CNSMR_TSS_MATCH_CRM_1.APT_NUM            AS APT_NUM_CRM                  
	 ,CNSMR_TSS_MATCH_CRM_1.PO_BOX_NUM         AS PO_BOX_NUM_CRM               
	 ,CNSMR_TSS_MATCH_CRM_1.CITY_NAME          AS CITY_NAME_CRM                
	 ,CNSMR_TSS_MATCH_CRM_1.POSTL_AREA_CODE    AS POSTL_AREA_CODE_CRM                          
	 ,CNSMR_TSS_MATCH_CRM_1.TERR_CODE          AS TERR_CODE_CRM
	 ,CNSMR_TSS_MATCH_CRM_1.CNTRY_CODE         AS CNTRY_CODE_CRM          
	 ,CNSMR_TSS_MATCH_CRM_1.EMAIL_ADDR_TXT_1   AS EMAIL_ADDR_TXT_1_CRM              
	 ,CNSMR_TSS_MATCH_CRM_1.PHONE_CNTRY_NBR_1  AS PHONE_CNTRY_NBR_1_CRM        
	 ,CNSMR_TSS_MATCH_CRM_1.PHONE_AREA_NBR_1   AS PHONE_AREA_NBR_1_CRM         
	 ,CNSMR_TSS_MATCH_CRM_1.PHONE_EXCHG_NBR_1  AS PHONE_EXCHG_NBR_1_CRM        
	 ,CNSMR_TSS_MATCH_CRM_1.PHONE_LINE_NBR_1   AS PHONE_LINE_NBR_1_CRM         
	 ,CNSMR_TSS_MATCH_CRM_1.PHONE_EXTSN_NUM_1  AS PHONE_EXTSN_NUM_1_CRM        
	 ,CNSMR_TSS_MATCH_CRM_1.FULL_PHONE_NUM_1   AS FULL_PHONE_NUM_1_CRM 
	 ,CNSMR_TSS_MATCH_CRM_1.WIN_KEY      AS WIN_KEY_CRM         
	 ,CNSMR_TSS_MATCH_CRM_1.DPEND_NAME         AS DPEND_NAME_CRM
	 ,CNSMR_TSS_MATCH_CRM_1.PET_NAME           AS PET_NAME_CRM
	 ,CNSMR_TSS_MATCH_CRM_1.REGIS_PRSNA_ID                  
	 ,CNSMR_TSS_MATCH_CRM_1.MATCHD_CNSMR_PRSNA_ID AS LEGAL_ENT_PRSNA_ID        
	 ,CNSMR_TSS_MATCH_CRM_1.HSHLD_PRSNA_ID     AS HSHLD_PRSNA_ID  
	 ,CNSMR_TSS_MATCH_CRM_1.LEGAL_ENT_NBR


  FROM PNGMDM.CNSMR_TSS_WINKEY CNSMR_TSS_MATCH_STG_1

  INNER JOIN PNGMDM.CNSMR_TSS_MATCH_CRM CNSMR_TSS_MATCH_CRM_1
    ON (CNSMR_TSS_MATCH_STG_1.WINDOW_KEY_01 = CNSMR_TSS_MATCH_CRM_1.WIN_KEY
   AND  CNSMR_TSS_MATCH_STG_1.WINDOW_KEY_01 <> ''
       )
    OR (CNSMR_TSS_MATCH_STG_1.EMAIL_ADDR_TXT = CNSMR_TSS_MATCH_CRM_1.EMAIL_ADDR_TXT_1
   AND  CNSMR_TSS_MATCH_STG_1.EMAIL_ADDR_TXT <> ''
       )
    OR (CNSMR_TSS_MATCH_STG_1.PHONE = CNSMR_TSS_MATCH_CRM_1.FULL_PHONE_NUM_1
   AND  CNSMR_TSS_MATCH_STG_1.PHONE <> ''
       )

;

