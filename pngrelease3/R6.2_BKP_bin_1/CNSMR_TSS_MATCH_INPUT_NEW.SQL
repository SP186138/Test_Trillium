DATABASE MDM;


REPLACE VIEW MDM.CNSMR_TSS_MATCH_INPUT
AS
LOCKING ROW FOR ACCESS

SELECT 
	  CNSMR_TSS_MATCH_CRM_1.MKTNG_PGM_NBR      AS MKTNG_PGM_NBR_CRM            
	 ,CNSMR_TSS_MATCH_CRM_1.REGIS_CNSMR_ID_VAL AS REGIS_CNSMR_ID_VAL_CRM       
	 ,CNSMR_TSS_MATCH_CRM_1.NAME_PREFX_TXT     AS NAME_PREFX_TXT_CRM           
	 ,CNSMR_TSS_MATCH_CRM_1.GVN_NAME           AS GVN_NAME_CRM                 
	 ,CNSMR_TSS_MATCH_CRM_1.MID_NAME           AS MID_NAME_CRM                 
	 ,CNSMR_TSS_MATCH_CRM_1.FAMLY_NAME         AS FAMLY_NAME_CRM               
	 ,CNSMR_TSS_MATCH_CRM_1.NAME_SUFFX_TXT     AS NAME_SUFFX_TXT_CRM           
	 ,CNSMR_TSS_MATCH_CRM_1.FULL_NAME          AS FULL_NAME_CRM                
	 ,CNSMR_TSS_MATCH_CRM_1.GENDR_IND          AS GENDR_IND_CRM                
	 ,CNSMR_TSS_MATCH_CRM_1.BRTH_DATE          AS BRTH_DATE_CRM                
	 ,CNSMR_TSS_MATCH_CRM_1.CNSMR_USER_NAME    AS USER_NAME_CRM                
	 ,CNSMR_TSS_MATCH_CRM_1.LANG_CODE          AS LANG_CODE_CRM    
	 ,CNSMR_TSS_MATCH_CRM_1.ADDR_LINE_1_TXT    AS ADDR_LINE_1_TXT_CRM          
	 ,CNSMR_TSS_MATCH_CRM_1.ADDR_LINE_2_TXT    AS ADDR_LINE_2_TXT_CRM          
	 ,CNSMR_TSS_MATCH_CRM_1.ADDR_LINE_3_TXT    AS ADDR_LINE_3_TXT_CRM          
	 ,CNSMR_TSS_MATCH_CRM_1.STRET_NUM          AS STRET_NUM_CRM                
	 ,CNSMR_TSS_MATCH_CRM_1.STRET_NAME         AS STRET_NAME_CRM               
	 ,CNSMR_TSS_MATCH_CRM_1.APT_NUM            AS APT_NUM_CRM                  
	 ,CNSMR_TSS_MATCH_CRM_1.PO_BOX_NUM         AS PO_BOX_NUM_CRM               
	 ,CNSMR_TSS_MATCH_CRM_1.CITY_NAME          AS CITY_NAME_CRM                
	 ,CNSMR_TSS_MATCH_CRM_1.POSTL_AREA_CODE    AS POSTL_AREA_CODE_CRM                          
	 ,CNSMR_TSS_MATCH_CRM_1.TERR_CODE          AS TERR_CODE_CRM
	 ,CNSMR_TSS_MATCH_CRM_1.CNTRY_CODE         AS CNTRY_CODE_CRM          
	 ,CNSMR_TSS_MATCH_CRM_1.EMAIL_ADDR_TXT_1   AS EMAIL_ADDR_TXT_1_CRM              
	 ,CNSMR_TSS_MATCH_CRM_1.PHONE_CNTRY_NBR_1  AS PHONE_CNTRY_NBR_1_CRM        
	 ,CNSMR_TSS_MATCH_CRM_1.PHONE_AREA_NBR_1   AS PHONE_AREA_NBR_1_CRM         
	 ,CNSMR_TSS_MATCH_CRM_1.PHONE_EXCHG_NBR_1  AS PHONE_EXCHG_NBR_1_CRM        
	 ,CNSMR_TSS_MATCH_CRM_1.PHONE_LINE_NBR_1   AS PHONE_LINE_NBR_1_CRM         
	 ,CNSMR_TSS_MATCH_CRM_1.PHONE_EXTSN_NUM_1  AS PHONE_EXTSN_NUM_1_CRM        
	 ,CNSMR_TSS_MATCH_CRM_1.FULL_PHONE_NUM_1   AS FULL_PHONE_NUM_1_CRM 
	 ,CNSMR_TSS_MATCH_CRM_1.WIN_KEY      AS WIN_KEY_CRM         
	 ,CNSMR_TSS_MATCH_CRM_1.DPEND_NAME         AS DPEND_NAME_CRM
	 ,CNSMR_TSS_MATCH_CRM_1.PET_NAME           AS PET_NAME_CRM
	 ,CNSMR_TSS_MATCH_CRM_1.REGIS_PRSNA_ID                  
	 ,CNSMR_TSS_MATCH_CRM_1.MATCHD_CNSMR_PRSNA_ID AS LEGAL_ENT_PRSNA_ID        
	 ,CNSMR_TSS_MATCH_CRM_1.HSHLD_PRSNA_ID     AS HSHLD_PRSNA_ID  
	 ,CNSMR_TSS_MATCH_CRM_1.LEGAL_ENT_NBR


  FROM MDM.CNSMR_TSS_WINKEY CNSMR_TSS_MATCH_STG_1

  INNER JOIN MDM.CNSMR_TSS_MATCH_CRM CNSMR_TSS_MATCH_CRM_1
    ON (CNSMR_TSS_MATCH_STG_1.WINDOW_KEY_01 = CNSMR_TSS_MATCH_CRM_1.WIN_KEY
   AND  CNSMR_TSS_MATCH_STG_1.WINDOW_KEY_01 <> ''
       )
    OR (CNSMR_TSS_MATCH_STG_1.EMAIL_ADDR_TXT = CNSMR_TSS_MATCH_CRM_1.EMAIL_ADDR_TXT_1
   AND  CNSMR_TSS_MATCH_STG_1.EMAIL_ADDR_TXT <> ''
       )
    OR (CNSMR_TSS_MATCH_STG_1.PHONE = CNSMR_TSS_MATCH_CRM_1.FULL_PHONE_NUM_1
   AND  CNSMR_TSS_MATCH_STG_1.PHONE <> ''
       )

;

